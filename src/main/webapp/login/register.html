<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>注册</title>
    <link rel="stylesheet" href="../css/bootstrap-4.5.3-dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../css/sign.css" />
    <script src="../js/juqery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
</head>
<body class="text-center" style="background-image: url(../image/bglogin.jpg); background-size: 50%;">
<form class="form-signin bg-light" onSubmit="return check(this);">
    <div class="mb-3">
        <a href="laws.html" target="_blank"><img src="../image/logo.png"alt="" width="309" height="90" /></a>
    </div>
    <h1 class="h3 mb-3 font-weight-normal">注册账户</h1>
    <div id="msg" class="small d-inline text-danger"></div>
    <label for="userName" class="sr-only">用户名</label>
    <input type="text" id="userName" class="form-control mb-1" name="username" placeholder="请输入用户名" required autofocus>
    <label for="userPassword" class="sr-only">密码</label>
    <input type="password" id="userPassword" class="form-control m-0 mb-1" name="password" placeholder="请输入密码" required>
    <label for="dupPassword" class="sr-only">密码</label>
    <input type="password" id="dupPassword" class="form-control mb-1" name="password1" placeholder="再次输入密码" required>
    <label for="verifyCode" class="sr-only">验证码</label>
    <input type="password" id="verifyCode" class="form-control w-50 mb-1" name="password1" placeholder="请输入验证码" required>
    <div  class="text-center ml-1 d-inline-block" alt="验证码" width="80" height="36">获取验证码</div>
    <div class="mb-3">
        <a href="login_in.html">&nbsp;&nbsp;&nbsp;直接登录</a>
    </div>
    <button id="register" class="btn btn-lg btn-primary btn-block" type="button">注册</button>
</form>
</div>
<script src="../js/style.js"></script>
<script>
    function getRootPath(){
        //获取当前网址
        var curWwwPath=window.document.location.href;
        //获取主机地址之后的目录
        var pathName=window.document.location.pathname;
        var pos=curWwwPath.indexOf(pathName);
        //获取主机地址
        var localhostPaht=curWwwPath.substring(0,pos);
        //获取带"/“的项目名
        var projectName=pathName.substring(0,pathName.substr(1).indexOf('/')+1);
        return(localhostPaht+projectName+"/");
    }
    $("#register").click(function () {
        let userName = document.getElementById("userName").value;
        let userPassword = document.getElementById("userPassword").value;
        let dupPassword = document.getElementById("dupPassword").value;
        let verifyCode = "";
        if (userPassword!==dupPassword) {
            console.log(userPassword);
            console.log(dupPassword);
            $("#msg").text("两次密码不一致");
        } else {
            $.ajax({
                type: "POST",
                url: getRootPath()+"register",
                async: false,
                dataType: "json",
                data:{
                    "userName": userName,
                    "userPassword": userPassword,
                    "verifyCode": verifyCode
                },
                success:function (res) {
                    if (res.msg==="registerSuccess") {
                        alert("注册成功");
                        window.location.href=getRootPath()+"login/login_in.html";
                    } else {
                        $("#msg").text("注册失败，该账号已存在");
                    }
                }
            });
        }
    });
</script>
</body>
</html>
